# This is... Use with include


PROJECT_NAME := `basename $$PWD`
DOXYFILE = Doxyfile
DOXYROOT = dox
DOXYPATTERNS = '*.dox *.cpp *.h'



$(DOXYROOT)/$(PROJECT_NAME):
	mkdir -p $(DOXYROOT)/$(PROJECT_NAME)
#	mkdir -p -m u+rwx $(DOXYROOT)/$(PROJECT_NAME)



# Idea: generate here a minimal Doxyfile, then update it.
$(DOXYFILE): $(DOXYROOT)/$(PROJECT_NAME) 
	date +'# Created by $$USER on %Y %m %d %H:%M '	  > $(DOXYFILE)
	echo PROJECT_NAME = $(PROJECT_NAME)		      >> $(DOXYFILE)
	echo OUTPUT_DIRECTORY = $(DOXYROOT)/$(PROJECT_NAME)   >> $(DOXYFILE)
	echo FILE_PATTERNS    =  $(DOXYPATTERNS) 	      >> $(DOXYFILE)
	cat Doxyfile.ini >> $(DOXYFILE)
#	echo TAGFILES	 = $(DOXYROOT)/*.tag              >> $(DOXYFILE)
#	echo GENERATE_TAGFILE = $(DOXYROOT)/$(PROJECT_NAME).tag >> $(DOXYFILE)
	doxygen -u $(DOXYFILE)

dox-clean:
	rm -vrf $(DOXYFILE) $(DOXYROOT)/$(PROJECT_NAME)/*


#dox: doc/latex
dox: $(DOXYFILE)
	doxygen $(DOXYFILE)


manual: dox
	cd ${DOXYROOT}/$(PROJECT_NAME)/latex/; pdflatex refman.tex; pdflatex refman.tex
	mv -v ${DOXYROOT}/$(PROJECT_NAME)/latex/refman.pdf $(PROJECT_NAME).pdf



